# Context
â€¢ Weâ€™re still on Milestoneâ€¯R2.  
â€¢ Earlier defensiveâ€‘code changes compile, but **tests now fail** and the Preview tab still shows â€œCannotâ€¯GETâ€¯/â€.
â€¢ Root causes observed:
  1. `tests/chat.test.js` has stray Markdown text (â€œThe changes involveâ€¦â€) at the very top â€“ Jest canâ€™t parse it.
  2. Our OpenAI mock inside that test file is still incomplete; each happyâ€‘path stub must return an object that has `choices: [{ message: { role:'assistant', content:'â€¦' } }]`.
  3. Server lacks a root â€œ/â€ route (needed only for the Preview panel). API itself works.

# Goals for this fix (please review & raise objections before you code)
1ï¸âƒ£  **Clean test file**  
    â€¢ Strip any nonâ€‘JS commentary / codeâ€‘fence lines that crept into `tests/chat.test.js`.  
    â€¢ Make sure the file starts with:  
      ```js
      const request = require('supertest');
      const app = require('../server/server');   // or the correct path
      jest.mock('../lib/openaiClient', () => ({ completion: jest.fn() }));
      ```
2ï¸âƒ£  **Robust OpenAI mocks**  
    â€¢ In each happyâ€‘path test case, mock should resolve to  
      ```js
      { choices: [{ message: { role: 'assistant', content: 'stubbed response' } }] }
      ```  
    â€¢ For malformed cases, deliberately return `{}` or `{ choices: [] }` so our nullâ€‘checks trigger aâ€¯500.
3ï¸âƒ£  **Confirm failingâ€‘forward logic**  
    â€¢ Reâ€‘run `npm test`; expect **all five tests to pass**:
      â€“ 2Ã—â€¯200 OK cases  
      â€“ 1Ã—â€¯422 ALLERGEN_CONFLICT  
      â€“ 2Ã—â€¯500 UPSTREAM_ERROR (one from bad mock, one from explicit throw)
    â€¢ If any still fail, output full error lines so we can decide whether to tighten mocks or route logic.
4ï¸âƒ£  **Add root route (Preview only)**  
    â€¢ In `server/server.js` (or routes file) add:  
      ```js
      app.get('/', (_req, res) => res.send('Nutriâ€‘GPT assistant is running'));
      ```  
      _No JSON, no auth, just text._
    â€¢ Ensure server listens on  
      ```js
      const PORT = process.env.PORT || 5000;
      app.listen(PORT, '0.0.0.0', â€¦);
      ```
    â€¢ Verify the `.replit` run cmd is still `npm start`.
5ï¸âƒ£  **Docs / logs**  
    â€¢ Append a short incident note under `docs/errors-log/jest_parse_failure.md`:
      - Symptom, root cause (markdown injected), resolution.
6ï¸âƒ£  **Leave everything unstaged** for my manual commit.

# Deliverables checklist
- [ ] `tests/chat.test.js` cleaned & mocks fixed.  
- [ ] All `npm test` cases green (agent should paste the summary).  
- [ ] Root `/` route returns text; Preview tab shows the message.  
- [ ] New errorâ€‘log MD added.  
- [ ] No files staged or committed.

ğŸ‘‰Â **Before you code:** confirm thereâ€™s no simpler way or hidden conflict.  
If the plan looks good, implement exactly the steps above.
